!function(t,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?exports.vmGeo=o():t.vmGeo=o()}(this,function(){return function(t){function o(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}var e={};return o.m=t,o.c=e,o.i=function(t){return t},o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},o.p="",o(o.s=0)}([function(t,o,e){"use strict";function n(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}function a(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(o,e,n){return e&&t(o.prototype,e),n&&t(o,n),o}}(),c=function(t){return"string"==typeof t},s=function(t){return"function"==typeof t},r="h5",l="qMap",u="bMap",p="aMap",f={1:"PERMISSION_DENIED",2:"POSITION_UNAVAILABLE",3:"TIMEOUT"},h=function(){function t(o){var e;a(this,t),this._ua=window.navigator.userAgent.toLowerCase(),this._setting={},this._default=(e={enableHighAccuracy:!0,maximumAge:1e3,timeout:1e4,fallBack:"aMap"},n(e,l,{key:"OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77",name:"qqMapName"}),n(e,u,{key:""}),n(e,p,{key:""}),e),this._aMapGeolocation=null,this._bMapGeolocation=null,this._qMapGeolocation=null,this.isHttps="https:"===window.location.protocol,this.isSupported=!!window.navigator.geolocation,this.isIos=this._ua.indexOf("iphone")>-1||this._ua.indexOf("ipad")>-1,Object.assign(this._setting,this._default,o)}return i(t,[{key:"getCurrentPosition",value:function(t){var o=this,e=this._ua.indexOf("alipay")>-1&&window.AlipayJSBridge;return t||(t=e?"alipay":r),t===r&&this.isIos&&!this.isHttps&&(t=this._setting.fallBack,console.info("[GEO]: 方法 getCurrentPosition() -> 如果在IOS下使用的不是HTTPS, 则使用备选方案'"+t+"'!")),new Promise(function(e,n){var a=function(o){var n={};switch(t){case r:n={lat:o.coords.latitude,lng:o.coords.longitude,mapType:r,full:o};break;case p:n={lat:o.position.lat,lng:o.position.lng,mapType:p,full:o};break;case u:n={lat:o.point.lat,lng:o.point.lng,mapType:u,full:o};break;case l:n={lat:o.lat,lng:o.lng,mapType:l,full:o};break;case"alipay":n={lat:o.latitude,lng:o.longitude,mapType:"alipay",full:o};break;default:n={lat:o.position.lat,lng:o.position.lng,mapType:p,full:o}}e(n)},i=function(o){var e=Object.prototype.toString.call(o).match(/^(\[object )(\w+)\]$/i)[2].toLowerCase();if("event"===e)return console.warn("[GEO]: 脚本加载错误 "+o.target.src),void n(o);if("string"===e)return console.warn("[GEO]: "+o),void n(o);switch(t){case r:o="[GEO]: CODE->"+o.code+"; INFO->"+f[o.code]+"; MESSAGE->"+o.message,console.warn(o);break;case p:o="[GEO]: INFO->"+o.info+"; MESSAGE->"+o.message,console.warn(o);break;case u:case l:o="[GEO]: "+JSON.stringify(o),console.warn(o);break;default:o="[GEO]: INFO->"+o.info+"; MESSAGE->"+o.message,console.warn(o)}n(o)},c={enableHighAccuracy:o._setting.enableHighAccuracy,maximumAge:o._setting.maximumAge,timeout:o._setting.timeout};t===r?o.isSupported?o._h5Location(a,i,c):(console.info("[GEO]:当前设备不支持'window.navigator.geolocation', 这里使用备选方案'"+o._setting.fallBack+"'!"),o._useMapLocation(a,i,c,o._setting.fallBack)):"alipay"===t?o._useAlipayLocation(a,i,c,t):o._useMapLocation(a,i,c,t)})}},{key:"watchPosition",value:function(){var t=function(){},o="",e=t,n=t,a={},i={enableHighAccuracy:this._setting.enableHighAccuracy,maximumAge:this._setting.maximumAge,timeout:this._setting.timeout},h=Array.from(arguments);c(h[0])&&s(h[1])&&(o=h[0],e=h[1],h[2]&&(n=h[2]),h[3]&&(a=h[3])),s(h[0])&&(o="h5",e=h[0],h[1]&&(n=h[1]),h[2]&&(a=h[2])),a=Object.assign({},i,a),o===r&&this.isIos&&!this.isHttps&&(o=this._setting.fallBack,console.info("[MESSAGE]:WatchPosition() - > 如果在IOS下使用的不是HTTPS, 则使用备选方案'"+o+"'!"));var g=function(t){var n={};switch(o){case r:n={lat:t.coords.latitude,lng:t.coords.longitude,mapType:r,full:t};break;case p:n={lat:t.position.lat,lng:t.position.lng,mapType:p,full:t};break;case u:n={lat:t.point.lat,lng:t.point.lng,mapType:u,full:t};break;case l:n={lat:t.lat,lng:t.lng,mapType:l,full:t};break;default:n={lat:t.position.lat,lng:t.position.lng,mapType:p,full:t}}e&&e(n)},d=function(t){var e=Object.prototype.toString.call(t).match(/^(\[object )(\w+)\]$/i)[2].toLowerCase();if("event"===e)return console.warn("[GEO]: 脚本加载错误 "+t.target.src),void(n&&n(t));if("string"===e)return console.warn("[GEO]: "+t),void(n&&n(t));switch(o){case r:t="[GEO]: CODE->"+t.code+"; TYPE->"+f[t.code]+"; MESSAGE->"+t.message,console.warn(t);break;case p:t="[GEO]: INFO->"+t.info+"; MESSAGE->"+t.message,console.warn(t);break;case u:case l:t="[GEO]: "+JSON.stringify(t),console.warn(t);break;default:t="[GEO]: INFO->"+t.info+"; MESSAGE->"+t.message,console.warn(t)}n&&n(t)},w=null;if(this._setting[o]&&this._setting[o].key)switch(o){case r:w=window.navigator.geolocation.watchPosition(g,d,a);break;case p:w=this._aMapWatchLocation(g,d,a);break;case u:console.error("百度地图并未提供 watchPosition() 方法, 请切换其他方式!");break;case l:w=this._qMapWatchLocation(g,d,a);break;default:w=this._aMapWatchLocation(g,d,a)}else n&&n("必须要为地图类型'"+o+"'提供key!");return w}},{key:"clearWatch",value:function(t){t&&(window.navigator.geolocation.clearWatch(t),this._aMapGeolocation&&this._aMapGeolocation.clearWatch(t),this._qMapGeolocation&&this._qMapGeolocation.clearWatch(t))}},{key:"_aMapWatchLocation",value:function(t,o){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._aMapGeolocation?this._aMapGeolocation.watchPosition(t,o,e):(console.warn("实例 aMapGeolocation 未定义, 在使用 watchPosition() 之前先获取一次本地位置 getCurrentPosition(), 成功后再进行 watchPosition()!"),this._aMapLocation(t,o,e),0)}},{key:"_qMapWatchLocation",value:function(t,o){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._qMapGeolocation?this._qMapGeolocation.watchPosition(t,o,e):(console.warn("实例 qMapWatchLocation 未定义, 在使用 watchPosition() 之前先获取一次本地位置 getCurrentPosition(), 成功后再进行 watchPosition()!"),this._qMapLocation(t,o,e),0)}},{key:"_useAlipayLocation",value:function(t,o){window.AlipayJSBridge&&window.AlipayJSBridge.call("getLocation",function(e){if(e.error)return void o(e.errorMessage);t(e)})}},{key:"_useMapLocation",value:function(t,o){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];if(this._setting[n].key)switch(n){case p:this._aMapLocation(t,o,e);break;case u:this._bMapLocation(t,o,e);break;case l:this._qMapLocation(t,o,e);break;default:this._aMapLocation(t,o,e)}else o("The map type of '"+n+"' must have key!")}},{key:"_aMapLocation",value:function(t,o){var e=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=function(){e._aMapGeolocation.getCurrentPosition(function(e,n){"complete"===e?t&&t(n):o&&o(e)})};this._aMapGeolocation?a():this._getScript("https://webapi.amap.com/maps?v=1.3&key="+this._setting[p].key).then(function(){window.setTimeout(function(){try{new window.AMap.Map("").plugin("AMap.Geolocation",function(){e._aMapGeolocation=new window.AMap.Geolocation(n),a()})}catch(t){o&&o(t)}},100)},function(t){o&&o(t)})}},{key:"_bMapLocation",value:function(t,o){var e=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=function(){e._bMapGeolocation.getCurrentPosition(function(e){this.getStatus()===window.BMAP_STATUS_SUCCESS?t&&t(e):o&&o(this.getStatus())},n)};this._bMapGeolocation?a():this._getScript("https://api.map.baidu.com/getscript?v=2.0&ak="+this._setting[u].key+"&services=&t="+ +new Date).then(function(){try{e._bMapGeolocation=new window.BMap.Geolocation,a()}catch(t){o&&o(t)}},function(t){o&&o(t)})}},{key:"_qMapLocation",value:function(t,o){var e=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=function(){e._qMapGeolocation.getLocation(t,o,{timeout:n.timeout})};this._qMapGeolocation?a():this._getScript("https://3gimg.qq.com/lightmap/components/geolocation/geolocation.min.js").then(function(){try{e._qMapGeolocation=new window.qq.maps.Geolocation(e._setting[l].key,e._setting[l].name),a()}catch(t){o&&o(t)}},function(t){o&&o(t)})}},{key:"_h5Location",value:function(t,o){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};window.navigator.geolocation.getCurrentPosition(t,o,e)}},{key:"_getScript",value:function(t){return new Promise(function(o,e){var n=document.createElement("script");n.type="text/javascript",n.src=t,n.onload=n.onreadystatechange=function(){this.readyState&&!/^(loaded|complete)$/.test(this.readyState)||(o(),n.onload=n.onreadystatechange=null)},n.onerror=function(t){e(t),n.onerror=null},document.body.appendChild(n)})}}]),t}(),g=function t(o,e){t.installed||(Object.defineProperty(o.prototype,"$geo",{get:function(){return new h(e)}}),t.installed=!0)},d={version:"0.0.4",install:g};t.exports=d}])});