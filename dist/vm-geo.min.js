!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.vmGeo=e():t.vmGeo=e()}(this,function(){return function(t){function e(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var o={};return e.m=t,e.c=o,e.i=function(t){return t},e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,o){"use strict";function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),c=function(t){return"string"==typeof t},s=function(t){return"function"==typeof t},r="h5",l="qMap",u="bMap",p="aMap",f={1:"PERMISSION_DENIED",2:"POSITION_UNAVAILABLE",3:"TIMEOUT"},h=function(){function t(e){var o;a(this,t),this._ua=window.navigator.userAgent.toLowerCase(),this._setting={},this._default=(o={enableHighAccuracy:!0,maximumAge:1e3,timeout:5e3,fallBack:"aMap"},n(o,l,{key:"OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77",name:"qqMapName"}),n(o,u,{key:""}),n(o,p,{key:""}),o),this._aMapGeolocation=null,this._bMapGeolocation=null,this._qMapGeolocation=null,this.isHttps="https:"===window.location.protocol,this.isSupported=!!window.navigator.geolocation,this.isIos=this._ua.indexOf("iphone")>-1||this._ua.indexOf("ipad")>-1,Object.assign(this._setting,this._default,e)}return i(t,[{key:"getCurrentPosition",value:function(t){var e=this,o=this._ua.indexOf("alipay")>-1&&window.AlipayJSBridge;return t||(t=o?"alipay":r),t===r&&this.isIos&&!this.isHttps&&(t=this._setting.fallBack,console.info("[GEO]: 方法 getCurrentPosition() -> 如果在IOS下使用的不是HTTPS, 则使用备选方案'"+t+"'!")),new Promise(function(o,n){var a=function(e){var n={};switch(t){case r:n={lat:e.coords.latitude,lng:e.coords.longitude,mapType:r,full:e};break;case p:n={lat:e.position.lat,lng:e.position.lng,mapType:p,full:e};break;case u:n={lat:e.point.lat,lng:e.point.lng,mapType:u,full:e};break;case l:n={lat:e.lat,lng:e.lng,mapType:l,full:e};break;case"alipay":n={lat:e.latitude,lng:e.longitude,mapType:"alipay",full:e};break;default:n={lat:e.position.lat,lng:e.position.lng,mapType:p,full:e}}o(n)},i=function(e){var o=Object.prototype.toString.call(e).match(/^(\[object )(\w+)\]$/i)[2].toLowerCase();if("event"===o)return console.warn("[GEO]: 脚本加载错误 "+e.target.src),void n(e);if("string"===o)return console.warn("[GEO]: "+e),void n(e);switch(t){case r:e="[GEO]: CODE->"+e.code+"; INFO->"+f[e.code]+"; MESSAGE->"+e.message,console.warn(e);break;case p:e="[GEO]: INFO->"+e.info+"; MESSAGE->"+e.message,console.warn(e);break;case u:case l:e="[GEO]: "+JSON.stringify(e),console.warn(e);break;default:e="[GEO]: INFO->"+e.info+"; MESSAGE->"+e.message,console.warn(e)}n(e)},c={enableHighAccuracy:e._setting.enableHighAccuracy,maximumAge:e._setting.maximumAge,timeout:e._setting.timeout};t===r?e.isSupported?e._h5Location(a,i,c):(console.info("[GEO]:当前设备不支持'window.navigator.geolocation', 这里使用备选方案'"+e._setting.fallBack+"'!"),e._useMapLocation(a,i,c,e._setting.fallBack)):"alipay"===t?e._useAlipayLocation(a,i,c,t):e._useMapLocation(a,i,c,t)})}},{key:"watchPosition",value:function(){var t=function(){},e="",o=t,n=t,a={},i={enableHighAccuracy:this._setting.enableHighAccuracy,maximumAge:this._setting.maximumAge,timeout:this._setting.timeout},h=Array.from(arguments);c(h[0])&&s(h[1])&&(e=h[0],o=h[1],h[2]&&(n=h[2]),h[3]&&(a=h[3])),s(h[0])&&(e="h5",o=h[0],h[1]&&(n=h[1]),h[2]&&(a=h[2])),a=Object.assign({},i,a),e===r&&this.isIos&&!this.isHttps&&(e=this._setting.fallBack,console.info("[MESSAGE]:WatchPosition() - > 如果在IOS下使用的不是HTTPS, 则使用备选方案'"+e+"'!"));var g=function(t){var n={};switch(e){case r:n={lat:t.coords.latitude,lng:t.coords.longitude,mapType:r,full:t};break;case p:n={lat:t.position.lat,lng:t.position.lng,mapType:p,full:t};break;case u:n={lat:t.point.lat,lng:t.point.lng,mapType:u,full:t};break;case l:n={lat:t.lat,lng:t.lng,mapType:l,full:t};break;default:n={lat:t.position.lat,lng:t.position.lng,mapType:p,full:t}}o&&o(n)},d=function(t){var o=Object.prototype.toString.call(t).match(/^(\[object )(\w+)\]$/i)[2].toLowerCase();if("event"===o)return console.warn("[GEO]: 脚本加载错误 "+t.target.src),void(n&&n(t));if("string"===o)return console.warn("[GEO]: "+t),void(n&&n(t));switch(e){case r:t="[GEO]: CODE->"+t.code+"; TYPE->"+f[t.code]+"; MESSAGE->"+t.message,console.warn(t);break;case p:t="[GEO]: INFO->"+t.info+"; MESSAGE->"+t.message,console.warn(t);break;case u:case l:t="[GEO]: "+JSON.stringify(t),console.warn(t);break;default:t="[GEO]: INFO->"+t.info+"; MESSAGE->"+t.message,console.warn(t)}n&&n(t)},y=null;if(this._setting[e]&&this._setting[e].key)switch(e){case r:y=window.navigator.geolocation.watchPosition(g,d,a);break;case p:y=this._aMapWatchLocation(g,d,a);break;case u:console.error("百度地图并未提供 watchPosition() 方法, 请切换其他方式!");break;case l:y=this._qMapWatchLocation(g,d,a);break;default:y=this._aMapWatchLocation(g,d,a)}else n&&n("必须要为地图类型'"+e+"'提供key!");return y}},{key:"clearWatch",value:function(t){t&&(window.navigator.geolocation.clearWatch(t),this._aMapGeolocation&&this._aMapGeolocation.clearWatch(t),this._qMapGeolocation&&this._qMapGeolocation.clearWatch(t))}},{key:"_aMapWatchLocation",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._aMapGeolocation?this._aMapGeolocation.watchPosition(t,e,o):(console.warn("实例 aMapGeolocation 未定义, 在使用 watchPosition() 之前先获取一次本地位置 getCurrentPosition(), 成功后再进行 watchPosition()!"),this._aMapLocation(t,e,o),0)}},{key:"_qMapWatchLocation",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._qMapGeolocation?this._qMapGeolocation.watchPosition(t,e,o):(console.warn("实例 qMapWatchLocation 未定义, 在使用 watchPosition() 之前先获取一次本地位置 getCurrentPosition(), 成功后再进行 watchPosition()!"),this._qMapLocation(t,e,o),0)}},{key:"_useAlipayLocation",value:function(t,e){window.AlipayJSBridge&&window.AlipayJSBridge.call("getLocation",function(o){if(o.error)return void e(o.errorMessage);t(o)})}},{key:"_useMapLocation",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];if(this._setting[n].key)switch(n){case p:this._aMapLocation(t,e,o);break;case u:this._bMapLocation(t,e,o);break;case l:this._qMapLocation(t,e,o);break;default:this._aMapLocation(t,e,o)}else e("The map type of '"+n+"' must have key!")}},{key:"_aMapLocation",value:function(t,e){var o=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=function(){o._aMapGeolocation.getCurrentPosition(function(o,n){"complete"===o?t&&t(n):e&&e(o)})};this._aMapGeolocation?a():this._getScript("https://webapi.amap.com/maps?v=1.3&key="+this._setting[p].key).then(function(){try{new window.AMap.Map("").plugin("AMap.Geolocation",function(){o._aMapGeolocation=new window.AMap.Geolocation(n),a()})}catch(t){e&&e(t)}},function(t){e&&e(t)})}},{key:"_bMapLocation",value:function(t,e){var o=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=function(){o._bMapGeolocation.getCurrentPosition(function(o){this.getStatus()===window.BMAP_STATUS_SUCCESS?t&&t(o):e&&e(this.getStatus())},n)};this._bMapGeolocation?a():this._getScript("https://api.map.baidu.com/getscript?v=2.0&ak="+this._setting[u].key+"&services=&t="+ +new Date).then(function(){try{o._bMapGeolocation=new window.BMap.Geolocation,a()}catch(t){e&&e(t)}},function(t){e&&e(t)})}},{key:"_qMapLocation",value:function(t,e){var o=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=function(){o._qMapGeolocation.getLocation(t,e,{timeout:n.timeout})};this._qMapGeolocation?a():this._getScript("https://3gimg.qq.com/lightmap/components/geolocation/geolocation.min.js").then(function(){try{o._qMapGeolocation=new window.qq.maps.Geolocation(o._setting[l].key,o._setting[l].name),a()}catch(t){e&&e(t)}},function(t){e&&e(t)})}},{key:"_h5Location",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};window.navigator.geolocation.getCurrentPosition(t,e,o)}},{key:"_getScript",value:function(t){return new Promise(function(e,o){var n=document.createElement("script");n.type="text/javascript",n.src=t,n.onload=n.onreadystatechange=function(){this.readyState&&!/^(loaded|complete)$/.test(this.readyState)||(e(),n.onload=n.onreadystatechange=null)},n.onerror=function(t){o(t),n.onerror=null},document.body.appendChild(n)})}}]),t}(),g=function t(e,o){t.installed||(Object.defineProperty(e.prototype,"$geo",{get:function(){return new h(o)}}),t.installed=!0)},d={version:"0.0.2",install:g};t.exports=d}])});